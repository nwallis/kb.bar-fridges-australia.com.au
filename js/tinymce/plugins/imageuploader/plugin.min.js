tinymce.PluginManager.add('imageuploader', function(editor, url) {
    editor.addButton('imageuploader', {
        text: 'Add Media',
        icon: 'image',
        onclick: function() {
            editor.windowManager.open({
                title: 'Select Media',
                url: '/upload.php',
                buttons: [{
                    text: 'Submit',
                    onclick: 'submit'
                }, {
                    text: 'Cancel',
                    onclick: 'close'
                }],
                width: 600,
                height: 300,
                onsubmit: function(e) {
                    var newMedia = $('iframe').contents().find('#media-url');
                    var url = newMedia.val();

                    if (url.length > 0) {
                        if (type == 'image') {
                            editor.insertContent('<img src="' + url + '" />');
                            return true;
                        } else if (type == 'video') {
                            editor.insertContent('<video autobuffer controls><source src="' + url + '" /></video>');
                            return true;
                        }
                    } else {
                        alert('something went wrong');
                        return false;
                    }
                }
            });
        }
    });
});
